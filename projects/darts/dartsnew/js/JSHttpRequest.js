function JsHttpRequest(){var t=this;t.onreadystatechange=null;t.readyState=0;t.responseText=null;t.responseXML=null;t.status=200;t.statusText="OK";t.responseJS=null;t.caching=false;t.loader=null;t.session_name="PHPSESSID";t._ldObj=null;t._reqHeaders=[];t._openArgs=null;t._errors={inv_form_el:"Invalid FORM element detected: name=%, tag=%",must_be_single_el:"If used, <form> must be a single HTML element in the list.",js_invalid:"JavaScript code generated by backend is invalid!\n%",url_too_long:"Cannot use so long query with GET request (URL is larger than % bytes)",unk_loader:"Unknown loader: %",no_loaders:"No loaders registered at all, please check JsHttpRequest.LOADERS array",no_loader_matched:"Cannot find a loader which may process the request. Notices are:\n%",no_headers:"Method setRequestHeader() cannot work together with the % loader."};t.abort=function(){with(this){if(_ldObj&&_ldObj.abort){_ldObj.abort()}_cleanup();if(readyState==0){return }if(readyState==1&&!_ldObj){readyState=0;return }_changeReadyState(4,true)}};t.open=function(method,url,asyncFlag,username,password){with(this){try{if(document.location.search.match(new RegExp("[&?]"+session_name+"=([^&?]*)"))||document.cookie.match(new RegExp("(?:;|^)\\s*"+session_name+"=([^;]*)"))){url+=(url.indexOf("?")>=0?"&":"?")+session_name+"="+this.escape(RegExp.$1)}}catch(e){}_openArgs={method:(method||"").toUpperCase(),url:url,asyncFlag:asyncFlag,username:username!=null?username:"",password:password!=null?password:""};_ldObj=null;_changeReadyState(1,true);return true}};t.send=function(content){if(!this.readyState){return }this._changeReadyState(1,true);this._ldObj=null;var queryText=[],queryElem=[];if(!this._hash2query(content,null,queryText,queryElem)){return }var hash=null;if(this.caching&&!queryElem.length){hash=this._openArgs.username+":"+this._openArgs.password+"@"+this._openArgs.url+"|"+queryText+"#"+this._openArgs.method;var cache=JsHttpRequest.CACHE[hash];if(cache){this._dataReady(cache[0],cache[1]);return false}}var loader=(this.loader||"").toLowerCase();if(loader&&!JsHttpRequest.LOADERS[loader]){return this._error("unk_loader",loader)}var errors=[],lds=JsHttpRequest.LOADERS;for(var tryLoader in lds){var ldr=lds[tryLoader].loader;if(!ldr){continue}if(loader&&tryLoader!=loader){continue}var ldObj=new ldr(this);JsHttpRequest.extend(ldObj,this._openArgs);JsHttpRequest.extend(ldObj,{queryText:queryText.join("&"),queryElem:queryElem,id:(new Date().getTime())+""+JsHttpRequest.COUNT++,hash:hash,span:null});var error=ldObj.load();if(!error){this._ldObj=ldObj;JsHttpRequest.PENDING[ldObj.id]=this;return true}if(!loader){errors[errors.length]="- "+tryLoader.toUpperCase()+": "+this._l(error)}else{return this._error(error)}}return tryLoader?this._error("no_loader_matched",errors.join("\n")):this._error("no_loaders")};t.getAllResponseHeaders=function(){with(this){return _ldObj&&_ldObj.getAllResponseHeaders?_ldObj.getAllResponseHeaders():[]}};t.getResponseHeader=function(label){with(this){return _ldObj&&_ldObj.getResponseHeader?_ldObj.getResponseHeader():[]}};t.setRequestHeader=function(label,value){with(this){_reqHeaders[_reqHeaders.length]=[label,value]}};t._dataReady=function(text,js){with(this){if(caching&&_ldObj){JsHttpRequest.CACHE[_ldObj.hash]=[text,js]}if(text!==null||js!==null){status=4;responseText=responseXML=text;responseJS=js}else{status=500;responseText=responseXML=responseJS=null}_changeReadyState(2);_changeReadyState(3);_changeReadyState(4);_cleanup()}};t._l=function(args){var i=0,p=0,msg=this._errors[args[0]];while((p=msg.indexOf("%",p))>=0){var a=args[++i]+"";msg=msg.substring(0,p)+a+msg.substring(p+1,msg.length);p+=1+a.length}return msg};t._error=function(msg){msg=this._l(typeof (msg)=="string"?arguments:msg);msg="JsHttpRequest: "+msg;if(!window.Error){throw msg}else{if((new Error(1,"test")).description=="test"){throw new Error(1,msg)}else{throw new Error(msg)}}};t._hash2query=function(content,prefix,queryText,queryElem){if(prefix==null){prefix=""}if((""+typeof (content)).toLowerCase()=="object"){var formAdded=false;if(content&&content.parentNode&&content.parentNode.appendChild&&content.tagName&&content.tagName.toUpperCase()=="FORM"){content={form:content}}for(var k in content){var v=content[k];if(v instanceof Function){continue}var curPrefix=prefix?prefix+"["+this.escape(k)+"]":this.escape(k),isFormElement=v&&v.parentNode&&v.parentNode.appendChild&&v.tagName;if(isFormElement){var tn=v.tagName.toUpperCase();if(tn=="FORM"){formAdded=true}else{if(tn=="INPUT"||tn=="TEXTAREA"||tn=="SELECT"){}else{return this._error("inv_form_el",(v.name||""),v.tagName)}}queryElem[queryElem.length]={name:curPrefix,e:v}}else{if(v instanceof Object){this._hash2query(v,curPrefix,queryText,queryElem)}else{if(v===null){continue}if(v===true){v=1}if(v===false){v=""}queryText[queryText.length]=curPrefix+"="+this.escape(""+v)}}if(formAdded&&queryElem.length>1){return this._error("must_be_single_el")}}}else{queryText[queryText.length]=content}return true};t._cleanup=function(){var ldObj=this._ldObj;if(!ldObj){return }JsHttpRequest.PENDING[ldObj.id]=false;var span=ldObj.span;if(!span){return }ldObj.span=null;var closure=function(){span.parentNode.removeChild(span)};JsHttpRequest.setTimeout(closure,50)};t._changeReadyState=function(s,reset){with(this){if(reset){status=statusText=responseJS=null;responseText=""}readyState=s;if(onreadystatechange){onreadystatechange()}}};t.escape=function(s){return escape(s).replace(new RegExp("\\+","g"),"%2B")}}JsHttpRequest.COUNT=0;JsHttpRequest.MAX_URL_LEN=2000;JsHttpRequest.CACHE={};JsHttpRequest.PENDING={};JsHttpRequest.LOADERS={};JsHttpRequest._dummy=function(){};JsHttpRequest.TIMEOUTS={s:window.setTimeout,c:window.clearTimeout};JsHttpRequest.setTimeout=function(E,G){window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.s;if(typeof (E)=="string"){F=window.JsHttpRequest_tmp(E,G)}else{var F=null,H=function(){E();delete JsHttpRequest.TIMEOUTS[F]};F=window.JsHttpRequest_tmp(H,G);JsHttpRequest.TIMEOUTS[F]=H}window.JsHttpRequest_tmp=null;return F};JsHttpRequest.clearTimeout=function(C){window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.c;delete JsHttpRequest.TIMEOUTS[C];var D=window.JsHttpRequest_tmp(C);window.JsHttpRequest_tmp=null;return D};JsHttpRequest.query=function(G,J,K,I){var L=new this;L.caching=!I;L.onreadystatechange=function(){if(L.readyState==4){K(L.responseJS,L.responseText)}};var H=null;if(G.match(/^((\w+)\.)?(GET|POST)\s+(.*)/i)){L.loader=RegExp.$2?RegExp.$2:null;H=RegExp.$3;G=RegExp.$4}L.open(H,G,true);L.send(J)};JsHttpRequest.dataReady=function(D){var F=this,E=F.PENDING[D.id];delete F.PENDING[D.id];if(E){E._dataReady(D.text,D.js)}else{if(E!==false){throw"dataReady(): unknown pending id: "+D.id}}};JsHttpRequest.extend=function(F,E){for(var D in E){F[D]=E[D]}};JsHttpRequest.LOADERS.xml={loader:function(req){JsHttpRequest.extend(req._errors,{xml_no:"Cannot use XMLHttpRequest or ActiveX loader: not supported",xml_no_diffdom:"Cannot use XMLHttpRequest to load data from different domain %",xml_no_headers:"Cannot use XMLHttpRequest loader or ActiveX loader, POST method: headers setting is not supported, needed to work with encodings correctly",xml_no_form_upl:"Cannot use XMLHttpRequest loader: direct form elements using and uploading are not implemented"});this.load=function(){if(this.queryElem.length){return["xml_no_form_upl"]}if(this.url.match(new RegExp("^([a-z]+)://([^\\/]+)(.*)","i"))){if(RegExp.$2.toLowerCase()==document.location.hostname.toLowerCase()){this.url=RegExp.$3}else{return["xml_no_diffdom",RegExp.$2]}}var xr=null;if(window.XMLHttpRequest){try{xr=new XMLHttpRequest}catch(e){}}else{if(window.ActiveXObject){try{xr=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}if(!xr){try{xr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}}}if(!xr){return["xml_no"]}var canSetHeaders=window.ActiveXObject||xr.setRequestHeader;if(!this.method){this.method=canSetHeaders?"POST":"GET"}if(this.method=="GET"){if(this.queryText){this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText}this.queryText="";if(this.url.length>JsHttpRequest.MAX_URL_LEN){return["url_too_long",JsHttpRequest.MAX_URL_LEN]}}else{if(this.method=="POST"&&!canSetHeaders){return["xml_no_headers"]}}this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+(req.caching?"0":this.id)+"-xml";var id=this.id;xr.onreadystatechange=function(){if(xr.readyState!=4){return }try{xr.onreadystatechange=JsHttpRequest._dummy;req.status=null;try{req.status=xr.status;req.responseText=xr.responseText}catch(e){}if(!req.status){return }try{eval("JsHttpRequest._tmp = function(id) { var d = "+req.responseText+"; d.id = id; JsHttpRequest.dataReady(d); }")}catch(e){return req._error("js_invalid",req.responseText)}JsHttpRequest._tmp(id);JsHttpRequest._tmp=null}catch(e){}};xr.open(this.method,this.url,true,this.username,this.password);if(canSetHeaders){for(var i=0;i<req._reqHeaders.length;i++){xr.setRequestHeader(req._reqHeaders[i][0],req._reqHeaders[i][1])}xr.setRequestHeader("Content-Type","application/octet-stream")}xr.send(this.queryText);this.span=null;this.xr=xr;return null};this.getAllResponseHeaders=function(){return this.xr.getAllResponseHeaders()};this.getResponseHeader=function(label){return this.xr.getResponseHeader(label)};this.abort=function(){this.xr.abort();this.xr=null}}};JsHttpRequest.LOADERS.script={loader:function(B){JsHttpRequest.extend(B._errors,{script_only_get:"Cannot use SCRIPT loader: it supports only GET method",script_no_form:"Cannot use SCRIPT loader: direct form elements using and uploading are not implemented"});this.load=function(){if(this.queryText){this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText}this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+this.id+"-script";this.queryText="";if(!this.method){this.method="GET"}if(this.method!=="GET"){return["script_only_get"]}if(this.queryElem.length){return["script_no_form"]}if(this.url.length>JsHttpRequest.MAX_URL_LEN){return["url_too_long",JsHttpRequest.MAX_URL_LEN]}if(B._reqHeaders.length){return["no_headers","SCRIPT"]}var I=this,H=document,J=null,A=H.body;if(!window.opera){this.span=J=H.createElement("SCRIPT");var G=function(){J.language="JavaScript";if(J.setAttribute){J.setAttribute("src",I.url)}else{J.src=I.url}A.insertBefore(J,A.lastChild)}}else{this.span=J=H.createElement("SPAN");J.style.display="none";A.insertBefore(J,A.lastChild);J.innerHTML="Workaround for IE.<script><\/script>";var G=function(){J=J.getElementsByTagName("SCRIPT")[0];J.language="JavaScript";if(J.setAttribute){J.setAttribute("src",I.url)}else{J.src=I.url}}}JsHttpRequest.setTimeout(G,10);return null}}};JsHttpRequest.LOADERS.form={loader:function(B){JsHttpRequest.extend(B._errors,{form_el_not_belong:'Element "%" does not belong to any form!',form_el_belong_diff:'Element "%" belongs to a different form. All elements must belong to the same form!',form_el_inv_enctype:'Attribute "enctype" of the form must be "%" (for IE), "%" given.'});this.load=function(){var R=this;if(!R.method){R.method="POST"}R.url+=(R.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+R.id+"-form";if(B._reqHeaders.length){return["no_headers","FORM"]}if(R.method=="GET"){if(R.queryText){R.url+=(R.url.indexOf("?")>=0?"&":"?")+R.queryText}if(R.url.length>JsHttpRequest.MAX_URL_LEN){return["url_too_long",JsHttpRequest.MAX_URL_LEN]}var P=R.url.split("?",2);R.url=P[0];R.queryText=P[1]||""}var S=null,T=false;if(R.queryElem.length){if(R.queryElem[0].e.tagName.toUpperCase()=="FORM"){S=R.queryElem[0].e;T=true;R.queryElem=[]}else{S=R.queryElem[0].e.form;for(var A=0;A<R.queryElem.length;A++){var X=R.queryElem[A].e;if(!X.form){return["form_el_not_belong",X.name]}if(X.form!=S){return["form_el_belong_diff",X.name]}}}if(R.method=="POST"){var V="multipart/form-data",Z=(S.attributes.encType&&S.attributes.encType.nodeValue)||(S.attributes.enctype&&S.attributes.enctype.value)||S.enctype;if(Z!=V){return["form_el_inv_enctype",V,Z]}}}var Y=S&&(S.ownerDocument||S.document)||document,Q="jshr_i_"+R.id,W=R.span=Y.createElement("DIV");W.style.position="absolute";W.style.display="none";W.style.visibility="hidden";W.innerHTML=(S?"":"<form"+(R.method=="POST"?' enctype="multipart/form-data" method="post"':"")+"></form>")+'<iframe name="'+Q+'" id="'+Q+'" style="width:0px; height:0px; overflow:hidden; border:none"></iframe>';if(!S){S=R.span.firstChild}Y.body.insertBefore(W,Y.body.lastChild);var U=function(C,I){var H=[],D=C;if(C.mergeAttributes){var D=Y.createElement("form");D.mergeAttributes(C,false)}for(var E=0;E<I.length;E++){var F=I[E][0],G=I[E][1];H[H.length]=[F,D.getAttribute(F)];D.setAttribute(F,G)}if(C.mergeAttributes){C.mergeAttributes(D,false)}return H},O=function(){top.JsHttpRequestGlobal=JsHttpRequest;var F=[];if(!T){for(var H=0,C=S.elements.length;H<C;H++){F[H]=S.elements[H].name;S.elements[H].name=""}}var D=R.queryText.split("&");for(var H=D.length-1;H>=0;H--){var E=D[H].split("=",2),G=Y.createElement("INPUT");G.type="hidden";G.name=unescape(E[0]);G.value=E[1]!=null?unescape(E[1]):"";S.appendChild(G)}for(var H=0;H<R.queryElem.length;H++){R.queryElem[H].e.name=R.queryElem[H].name}var I=U(S,[["action",R.url],["method",R.method],["onsubmit",null],["target",Q]]);S.submit();U(S,I);for(var H=0;H<D.length;H++){S.lastChild.parentNode.removeChild(S.lastChild)}if(!T){for(var H=0,C=S.elements.length;H<C;H++){S.elements[H].name=F[H]}}};JsHttpRequest.setTimeout(O,100);return null}}}